import{u as E,a as F,b as B}from"./chunk-ZJRFL6ZN-CeUf_1TQ.js";import{ah as I,j as e,b as j,r as p,eC as D,aD as H,aE as M,ax as N,es as O,t as x,a3 as K,B as S,aI as L,az as V,g as $,al as q,a4 as b}from"./index-DsV72Lgh.js";import{u as Q,_ as Z}from"./chunk-YTN73JYH-CNuodvoK.js";import"./chunk-GU5PJRPM-O5M6LXf4.js";import{K as J}from"./chunk-6HTZNHPT-DGQV_Lcz.js";import{R as l,u as U}from"./chunk-AERWK3TJ-DmmmqBU-.js";import"./chunk-C76H5USB-CiyvsDlP.js";import"./chunk-MSDRGCRR-BmkTKcWe.js";import"./chunk-P3UUX2T6-BC4tQC_j.js";import"./chunk-HQKGZADC-Dbir7G86.js";import"./chunk-EMIHDNB7-DRJ-T97v.js";import"./chunk-DZWH2RV6-DwC22Jxm.js";import"./index-Do-4R60H.js";var W=N({customer_group_ids:L(V()).min(1)}),g=10,X=({customerId:a})=>{const{t:o}=j(),{handleSuccess:f}=U(),[r,u]=p.useState(!1),{mutateAsync:h}=D(a),n=H({defaultValues:{customer_group_ids:[]},resolver:M(W)}),{setValue:i}=n,[c,_]=p.useState({});p.useEffect(()=>{i("customer_group_ids",Object.keys(c).filter(t=>c[t]),{shouldDirty:!0,shouldTouch:!0})},[c,i]);const{searchParams:v,raw:T}=E({pageSize:g}),P=F(),{customer_groups:m,count:y,isPending:R,isError:k,error:w}=O({fields:"*customers",...v}),A=t=>{const s=typeof t=="function"?t(c):t,d=Object.keys(s);i("customer_group_ids",d,{shouldDirty:!0,shouldTouch:!0}),_(s)},C=ee(),{table:G}=Q({data:m??[],columns:C,count:y,enablePagination:!0,enableRowSelection:t=>{var s;return!((s=t.original.customers)!=null&&s.map(d=>d.id).includes(a))},getRowId:t=>t.id,pageSize:g,rowSelection:{state:c,updater:A}}),z=n.handleSubmit(async t=>{u(!0);try{await h({add:t.customer_group_ids}),x.success(o("customers.groups.add.success",{groups:t.customer_group_ids.map(s=>m==null?void 0:m.find(d=>d.id===s)).filter(Boolean).map(s=>s==null?void 0:s.name)})),f(`/customers/${a}`)}catch(s){x.error(s.message)}finally{u(!1)}});if(k)throw w;return e.jsx(l.Form,{form:n,children:e.jsxs(J,{className:"flex h-full flex-col overflow-hidden",onSubmit:z,children:[e.jsx(l.Header,{children:e.jsx("div",{className:"flex items-center justify-end gap-x-2",children:n.formState.errors.customer_group_ids&&e.jsx(K,{variant:"error",children:n.formState.errors.customer_group_ids.message})})}),e.jsx(l.Body,{className:"size-full overflow-hidden",children:e.jsx(Z,{table:G,columns:C,pageSize:g,count:y,filters:P,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],isLoading:R,layout:"fill",search:"autofocus",queryObject:T,noRecords:{message:o("customers.groups.add.list.noRecordsMessage")}})}),e.jsxs(l.Footer,{children:[e.jsx(l.Close,{asChild:!0,children:e.jsx(S,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(S,{type:"submit",variant:"primary",size:"small",isLoading:r,children:o("actions.save")})]})]})})},Y=$(),ee=()=>{const{t:a}=j(),o=B();return p.useMemo(()=>[Y.display({id:"select",header:({table:r})=>e.jsx(b,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:u=>r.toggleAllPageRowsSelected(!!u)}),cell:({row:r})=>{const u=!r.getCanSelect(),h=r.getIsSelected()||u,n=e.jsx(b,{checked:h,disabled:u,onCheckedChange:i=>r.toggleSelected(!!i),onClick:i=>{i.stopPropagation()}});return u?e.jsx(q,{content:a("customers.groups.alreadyAddedTooltip"),side:"right",children:n}):n}}),...o],[a,o])},he=()=>{const{id:a}=I();return e.jsx(l,{children:e.jsx(X,{customerId:a})})};export{he as Component};
