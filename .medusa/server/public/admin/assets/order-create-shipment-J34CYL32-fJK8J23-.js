import{K as k}from"./chunk-6HTZNHPT-BJ6krZ6N.js";import{R as c,u as v}from"./chunk-AERWK3TJ-D_sd7NgU.js";import{ah as C,dd as F,j as e,b as S,dN as w,aD as E,aE as L,ax as _,N as M,t as y,H as I,_ as x,J as s,K as b,B as g,aG as T,ay as H,aI as $,az as f}from"./index-BcvhWi3G.js";var z=_({labels:$(_({tracking_number:f(),tracking_url:f().optional(),label_url:f().optional()})),send_notification:H().optional()});function O({order:d,fulfillment:l}){const{t:r}=S(),{handleSuccess:h}=v(),{mutateAsync:u,isPending:j}=w(d.id,l==null?void 0:l.id),i=E({defaultValues:{send_notification:!d.no_notification},resolver:L(z)}),{fields:m,append:p}=M({name:"labels",control:i.control}),N=i.handleSubmit(async o=>{var t;const n=o.labels.filter(a=>!!a.tracking_number||!!a.tracking_url||!!a.label_url).map(a=>({tracking_number:a.tracking_number,tracking_url:a.tracking_url||"#",label_url:a.label_url||"#"}));await u({items:(t=l==null?void 0:l.items)==null?void 0:t.map(a=>({id:a.line_item_id,quantity:a.quantity})),labels:[...n,...(l==null?void 0:l.labels)||[]],no_notification:!o.send_notification},{onSuccess:()=>{y.success(r("orders.shipment.toastCreated")),h(`/orders/${d.id}`)},onError:a=>{y.error(a.message)}})});return e.jsx(c.Form,{form:i,children:e.jsxs(k,{onSubmit:N,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(c.Header,{}),e.jsx(c.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(I,{className:"mb-4",children:r("orders.shipment.title")}),e.jsx("div",{className:"flex flex-col max-md:gap-y-2 max-md:divide-y",children:m.map((o,n)=>e.jsxs("div",{className:x("grid grid-cols-1 gap-x-4 md:grid-cols-3",{"max-md:pt-4":n>0}),children:[e.jsx(s.Field,{control:i.control,name:`labels.${n}.tracking_number`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":n>0}),children:r("orders.shipment.trackingNumber")}),e.jsx(s.Control,{children:e.jsx(b,{...t,placeholder:"123-456-789"})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:`labels.${n}.tracking_url`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":n>0}),children:r("orders.shipment.trackingUrl")}),e.jsx(s.Control,{children:e.jsx(b,{...t,placeholder:"https://example.com/tracking/123"})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:i.control,name:`labels.${n}.label_url`,render:({field:t})=>e.jsxs(s.Item,{className:"mb-2",children:[e.jsx(s.Label,{className:x({"md:hidden":n>0}),children:r("orders.shipment.labelUrl")}),e.jsx(s.Control,{children:e.jsx(b,{...t,placeholder:"https://example.com/label/123"})}),e.jsx(s.ErrorMessage,{})]})})]},o.id))}),e.jsx(g,{type:"button",onClick:()=>p({tracking_number:"",label_url:"",tracking_url:""}),className:"mt-2 self-end",variant:"secondary",children:r("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(s.Field,{control:i.control,name:"send_notification",render:({field:{onChange:o,value:n,...t}})=>e.jsxs(s.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(s.Label,{children:r("orders.shipment.sendNotification")}),e.jsx(s.Control,{children:e.jsx(s.Control,{children:e.jsx(T,{dir:"ltr",className:"rtl:rotate-180",checked:!!n,onCheckedChange:o,...t})})})]}),e.jsx(s.Hint,{className:"!mt-1",children:r("orders.shipment.sendNotificationHint")}),e.jsx(s.ErrorMessage,{})]})})})]})})})}),e.jsxs(c.Footer,{children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(g,{size:"small",variant:"secondary",children:r("actions.cancel")})}),e.jsx(g,{size:"small",type:"submit",isLoading:j,children:r("actions.save")})]})]})})}function q(){var m;const{id:d,f_id:l}=C(),{order:r,isLoading:h,isError:u,error:j}=F(d,{fields:"*fulfillments,*fulfillments.items,*fulfillments.labels"});if(u)throw j;const i=!h&&r;return e.jsx(c,{children:i&&e.jsx(O,{order:r,fulfillment:(m=r.fulfillments)==null?void 0:m.find(p=>p.id===l)})})}export{q as Component};
