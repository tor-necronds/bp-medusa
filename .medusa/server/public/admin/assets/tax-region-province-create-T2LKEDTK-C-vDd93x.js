import{a as S}from"./chunk-EHAU7SOS-BdFruKSz.js";import{P}from"./chunk-KEQOAJC2-DU6HnKwK.js";import{S as E}from"./chunk-PRLQLEEQ-B9h0akXI.js";import{K as L}from"./chunk-6HTZNHPT-BJ6krZ6N.js";import{R as m,u as $}from"./chunk-AERWK3TJ-D_sd7NgU.js";import{ah as M,gf as z,j as e,b as F,aD as B,aE as K,ax as _,ge as H,t as C,H as T,a5 as N,J as a,r as R,K as y,al as V,d6 as D,B as w,ay as J,az as g,aK as k,aw as f}from"./index-BcvhWi3G.js";var I=R.forwardRef(({disabled:l,placeholder:o,defaultValue:t,country_code:r,valueAs:i="iso_2",onChange:u,...d},c)=>{const{t:j}=F(),p=R.useRef(null);R.useImperativeHandle(c,()=>p.current);const s=S(r);s||(l=!0);const h=Object.entries((s==null?void 0:s.options)??{}).map(([n,b])=>e.jsx(f.Item,{value:i==="iso_2"?n.toLowerCase():b,children:b},n)),x=s?j(`taxRegions.fields.sublevels.placeholders.${s.type}`):"";return e.jsx("div",{className:"relative",children:e.jsxs(f,{...d,value:d.value?i==="iso_2"?d.value.toLowerCase():d.value:void 0,defaultValue:t?i==="iso_2"?t.toLowerCase():t:void 0,onValueChange:u,disabled:l,children:[e.jsx(f.Trigger,{ref:p,className:"w-full",children:e.jsx(f.Value,{placeholder:o||x})}),e.jsx(f.Content,{children:h})]})})});I.displayName="ProvinceSelect";var q=_({province_code:g().min(1),name:g().optional(),code:g().min(1),rate:_({float:k().optional(),value:g().optional()}).optional(),is_combinable:J().optional()}),G=({parent:l})=>{const{t:o}=F(),{handleSuccess:t}=$(),r=B({defaultValues:{province_code:"",code:"",is_combinable:!1,name:"",rate:{value:""}},resolver:K(q)}),{mutateAsync:i,isPending:u}=H(),d=r.handleSubmit(async s=>{var x;const h=s.name&&((x=s.rate)!=null&&x.float)?{name:s.name,rate:s.rate.float,code:s.code,is_combinable:s.is_combinable}:void 0;await i({country_code:l.country_code,province_code:s.province_code,parent_id:l.id,default_tax_rate:h},{onSuccess:({tax_region:n})=>{C.success(o("taxRegions.create.successToast")),t(`/settings/tax-regions/${l.id}/provinces/${n.id}`)},onError:n=>{C.error(n.message)}})}),c=S(l.country_code),j=(c==null?void 0:c.type)||"sublevel",p=o(`taxRegions.fields.sublevels.labels.${j}`);return e.jsx(m.Form,{form:r,children:e.jsxs(L,{onSubmit:d,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(m.Header,{}),e.jsx(m.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(T,{children:o(`taxRegions.${j}.create.header`)}),e.jsx(N,{size:"small",className:"text-ui-fg-subtle",children:o(`taxRegions.${j}.create.hint`)})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(a.Field,{control:r.control,name:"province_code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{tooltip:!c&&o("taxRegions.fields.sublevels.tooltips.sublevel"),children:p}),e.jsx(a.Control,{children:c?e.jsx(I,{country_code:l.country_code,...s}):e.jsx(y,{...s,placeholder:"KR-26"})}),e.jsx(a.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(T,{level:"h2",className:"!txt-compact-small-plus",children:o("taxRegions.fields.defaultTaxRate.label")}),e.jsxs(N,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:["(",o("fields.optional"),")"]}),e.jsx(V,{content:o("taxRegions.fields.defaultTaxRate.tooltip"),children:e.jsx(D,{className:"text-ui-fg-muted"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(a.Field,{control:r.control,name:"name",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("fields.name")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"rate",render:({field:{value:s,onChange:h,...x}})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxRate")}),e.jsx(a.Control,{children:e.jsx(P,{...x,value:s==null?void 0:s.value,decimalsLimit:4,onValueChange:(n,b,v)=>h({value:n,float:v==null?void 0:v.float})})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:r.control,name:"code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxCode")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})})]})]}),e.jsx(E,{control:r.control,name:"is_combinable",label:o("taxRegions.fields.isCombinable.label"),description:o("taxRegions.fields.isCombinable.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(w,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(w,{size:"small",type:"submit",isLoading:u,children:o("actions.save")})]})})]})})},Z=()=>{const{id:l}=M(),{tax_region:o,isPending:t,isError:r,error:i}=z(l),u=!t&&!!o;if(r)throw i;return e.jsx(m,{children:u&&e.jsx(G,{parent:o})})};export{Z as Component,Z as TaxProvinceCreate};
