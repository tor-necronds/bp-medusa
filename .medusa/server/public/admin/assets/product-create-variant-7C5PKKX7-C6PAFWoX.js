import{u as te}from"./chunk-3TZOFKX2-Dm9sMIO-.js";import{C as $}from"./chunk-OFN7DIZA-CpT302SF.js";import{o as ne,p as H}from"./chunk-ZQRKUG6J-CBKDOkBc.js";import{D as G,c as se,a as ie}from"./chunk-W7SLPIO2-D-JeoQt4.js";import{c as D}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as ae}from"./chunk-6HTZNHPT-DGQV_Lcz.js";import{R as C,u as R,b as le}from"./chunk-AERWK3TJ-DmmmqBU-.js";import{ah as oe,ag as ce,j as e,b as w,z as de,r as b,aD as ue,aE as me,ax as B,b6 as xe,x as W,F,N as A,t as pe,B as P,aI as he,aH as K,ay as S,az as g,aK as ve,H as J,J as r,K as I,aG as V,v as fe,y as je,s as ye,$ as O,a1 as ge,a2 as be}from"./index-DsV72Lgh.js";import{P as j}from"./progress-tabs-D3iKUJao.js";import"./chunk-DK4WIVY6-CYCbBMOO.js";var L=B({title:g().min(1),sku:g().optional(),manage_inventory:S().optional(),allow_backorder:S().optional(),inventory_kit:S().optional(),options:K(g()),prices:K(g(),g().or(ve()).optional()).optional(),inventory:he(B({inventory_item_id:g(),required_quantity:ne})).optional()}),X=L.pick({title:!0,sku:!0,manage_inventory:!0,allow_backorder:!0,inventory_kit:!0,options:!0}),_e=Object.keys(X.shape),Q=L.pick({prices:!0}),Ne=Object.keys(Q.shape);function Ce({form:s,product:i}){const{t:a}=w(),c=F({control:s.control,name:"manage_inventory"});return e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-8 py-16",children:[e.jsx(J,{level:"h1",children:a("products.variant.create.header")}),e.jsxs("div",{className:"my-8 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(r.Field,{control:s.control,name:"title",render:({field:t})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:a("fields.title")}),e.jsx(r.Control,{children:e.jsx(I,{...t})}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"sku",render:({field:t})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{optional:!0,children:a("fields.sku")}),e.jsx(r.Control,{children:e.jsx(I,{...t})}),e.jsx(r.ErrorMessage,{})]})}),i.options.map(t=>e.jsx(r.Field,{control:s.control,name:`options.${t.title}`,render:({field:{value:d,onChange:l,...n}})=>e.jsxs(r.Item,{children:[e.jsx(r.Label,{children:t.title}),e.jsx(r.Control,{children:e.jsx($,{value:d,onChange:o=>{l(o)},...n,options:t.values.map(o=>({label:o.value,value:o.value}))})})]})},t.id))]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(r.Field,{control:s.control,name:"manage_inventory",render:({field:{value:t,onChange:d,...l}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(V,{dir:"ltr",className:"mt-[2px] rtl:rotate-180",checked:t,onCheckedChange:n=>d(!!n),...l})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:a("products.variant.inventory.manageInventoryLabel")}),e.jsx(r.Hint,{children:a("products.variant.inventory.manageInventoryHint")})]})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"allow_backorder",disabled:!c,render:({field:{value:t,onChange:d,...l}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(V,{dir:"ltr",className:"rtl:rotate-180",checked:t,onCheckedChange:n=>d(!!n),...l,disabled:!c})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:a("products.variant.inventory.allowBackordersLabel")}),e.jsx(r.Hint,{children:a("products.variant.inventory.allowBackordersHint")})]})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(r.Field,{control:s.control,name:"inventory_kit",render:({field:{value:t,onChange:d,...l}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest flex gap-x-3 rounded-lg p-4",children:[e.jsx(r.Control,{children:e.jsx(V,{dir:"ltr",className:"rtl:rotate-180",checked:t,onCheckedChange:n=>d(!!n),...l,disabled:!c})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:a("products.variant.inventory.inventoryKit")}),e.jsx(r.Hint,{children:a("products.variant.inventory.inventoryKitHint")})]})]}),e.jsx(r.ErrorMessage,{})]})})]})]})})}var we=Ce;function ke({form:s}){const{t:i}=w(),a=A({control:s.control,name:"inventory"}),c=a.fields,t=te({queryKey:["inventory_items"],queryFn:l=>ye.admin.inventoryItem.list(l),getOptions:l=>l.inventory_items.map(n=>({label:n.title,value:n.id}))}),d=(l,n)=>c==null?void 0:c.some((o,h)=>h!=n&&o.inventory_item_id===l.value);return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(J,{children:i("products.create.inventory.heading")}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{children:s.getValues("title")}),e.jsx(r.Hint,{children:i("products.create.inventory.label")})]}),e.jsx(P,{size:"small",variant:"secondary",type:"button",onClick:()=>{a.append({inventory_item_id:"",required_quantity:""})},children:i("actions.add")})]}),a.fields.map((l,n)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(O,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.inventory_item_id`,children:i("fields.item")})}),e.jsx(r.Field,{control:s.control,name:`inventory.${n}.inventory_item_id`,render:({field:o})=>e.jsx(r.Item,{children:e.jsx(r.Control,{children:e.jsx($,{...o,options:t.options.map(h=>({...h,disabled:d(h,n)})),searchValue:t.searchValue,onSearchValueChange:t.onSearchValueChange,fetchNextPage:t.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:i("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(O,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.required_quantity`,children:i("fields.quantity")})}),e.jsx(r.Field,{control:s.control,name:`inventory.${n}.required_quantity`,render:({field:{onChange:o,value:h,...T}})=>e.jsxs(r.Item,{children:[e.jsx(r.Control,{children:e.jsx(I,{type:"number",className:"bg-ui-bg-field-component",min:0,value:h,onChange:y=>{const k=y.target.value;o(k===""?null:Number(k))},...T,placeholder:i("products.create.inventory.quantityPlaceholder")})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(ge,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>a.remove(n),children:e.jsx(be,{})})]},l.id))]})]})})})}var Fe=ke;function Pe({form:s}){const{store:i}=fe(),{regions:a}=W({limit:9999}),{price_preferences:c}=je({}),{setCloseOnEscape:t}=R(),d=qe({currencies:i==null?void 0:i.supported_currencies,regions:a,pricePreferences:c}),l=F({control:s.control});return e.jsx(G,{columns:d,data:[l],state:s,onEditingChange:n=>t(!n)})}var Te=se(),qe=({currencies:s=[],regions:i=[],pricePreferences:a=[]})=>{const{t:c}=w();return b.useMemo(()=>[Te.column({id:c("fields.title"),header:c("fields.title"),cell:t=>{const d=t.row.original;return e.jsx(G.ReadonlyCell,{context:t,children:e.jsx("div",{className:"flex h-full w-full items-center gap-x-2 overflow-hidden",children:e.jsx("span",{className:"truncate",children:d.title})})})},disableHiding:!0}),...ie({currencies:s.map(t=>t.currency_code),regions:i,pricePreferences:a,getFieldName:(t,d)=>{var l;return(l=t.column.id)!=null&&l.startsWith("currency_prices")?`prices.${d}`:`prices.${d}`},t:c})],[c,s,i,a])},Ee=Pe,Se={detail:"in-progress",price:"not-started",inventory:"not-started"},Ve=({product:s})=>{const{t:i}=w(),{handleSuccess:a}=R(),c=de(),[t,d]=b.useState("detail"),[l,n]=b.useState(Se),o=ue({defaultValues:{sku:"",title:"",manage_inventory:!1,allow_backorder:!1,inventory_kit:!1,options:{}},resolver:me(L)}),{mutateAsync:h,isPending:T}=xe(s.id),{regions:y}=W({limit:9999}),k=b.useMemo(()=>y!=null&&y.length?y.reduce((u,f)=>(u[f.id]=f.currency_code,u),{}):{},[y]),U=F({control:o.control,name:"manage_inventory"}),q=F({control:o.control,name:"inventory_kit"}),M=A({control:o.control,name:"inventory"}),_=U&&q,v=b.useMemo(()=>_?["detail","price","inventory"]:["detail","price"],[_]);b.useEffect(()=>{q&&M.fields.length===0&&M.append({inventory_item_id:"",required_quantity:void 0})},[q]);const z=u=>{if(t===u)return;if(v.indexOf(u)<v.indexOf(t)){n(m=>({...m,[t]:"not-started",[u]:"in-progress"})),d(u);return}const f=v.slice(0,v.indexOf(u));for(const m of f)if(m==="detail"){if(!H(o,_e,X)){n(p=>({...p,[m]:"in-progress"})),d(m);return}n(p=>({...p,[m]:"completed"}))}else if(m==="price"){if(!H(o,Ne,Q)){n(p=>({...p,[m]:"in-progress"})),d(m);return}n(p=>({...p,[m]:"completed"}))}n(m=>({...m,[t]:"completed",[u]:"in-progress"})),d(u)},Y=u=>{if(v.indexOf(u)+1>=v.length)return;const f=v[v.indexOf(u)+1];z(f)},Z=o.handleSubmit(async u=>{const{allow_backorder:f,manage_inventory:m,sku:p,title:ee}=u;await h({title:ee,sku:p||void 0,allow_backorder:f,manage_inventory:m,options:u.options,prices:Object.entries(u.prices??{}).map(([x,E])=>{if(E===""||E===void 0)return;const N={},re=D(E);return x.startsWith("reg_")?(N.rules={region_id:x},N.currency_code=k[x]):N.currency_code=x,N.amount=re,N}).filter(Boolean),inventory_items:(u.inventory||[]).map(x=>!x.required_quantity||!x.inventory_item_id?!1:{...x,required_quantity:D(x.required_quantity)}).filter(Boolean)},{onSuccess:()=>{a()},onError:x=>{pe.error(x.message)}})});return e.jsx(C.Form,{form:o,children:e.jsx(j,{dir:c,value:t,onValueChange:u=>z(u),className:"flex h-full flex-col overflow-hidden",children:e.jsxs(ae,{onSubmit:Z,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(C.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-x-4",children:e.jsx("div",{className:"-my-2 w-full max-w-[600px] border-l",children:e.jsxs(j.List,{className:"grid w-full grid-cols-3",children:[e.jsx(j.Trigger,{status:l.detail,value:"detail",children:i("priceLists.create.tabs.details")}),e.jsx(j.Trigger,{status:l.price,value:"price",children:i("priceLists.create.tabs.prices")}),!!_&&e.jsx(j.Trigger,{status:l.inventory,value:"inventory",children:i("products.create.tabs.inventory")})]})})})}),e.jsxs(C.Body,{className:"size-full overflow-hidden",children:[e.jsx(j.Content,{className:"size-full overflow-y-auto",value:"detail",children:e.jsx(we,{form:o,product:s})}),e.jsx(j.Content,{className:"size-full overflow-y-auto",value:"price",children:e.jsx(Ee,{form:o})}),!!_&&e.jsx(j.Content,{className:"size-full overflow-hidden",value:"inventory",children:e.jsx(Fe,{form:o})})]}),e.jsx(C.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(le.Close,{asChild:!0,children:e.jsx(P,{variant:"secondary",size:"small",children:i("actions.cancel")})}),e.jsx(Ie,{tab:t,next:Y,isLoading:T,inventoryTabEnabled:!!_})]})})]})})})},Ie=({tab:s,next:i,isLoading:a,inventoryTabEnabled:c})=>{const{t}=w();return c&&s==="inventory"||!c&&s==="price"?e.jsx(P,{type:"submit",variant:"primary",size:"small",isLoading:a,children:t("actions.save")},"submit-button"):e.jsx(P,{type:"button",variant:"primary",size:"small",onClick:()=>i(s),children:t("actions.continue")},"next-button")},Re=()=>{const{id:s}=oe(),{product:i,isLoading:a,isError:c,error:t}=ce(s);if(c)throw t;return e.jsx(C,{children:!a&&i&&e.jsx(Ve,{product:i})})};export{Re as Component};
