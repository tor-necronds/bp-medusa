import{K as M}from"./chunk-6HTZNHPT-BJ6krZ6N.js";import{b as o,u as _}from"./chunk-AERWK3TJ-D_sd7NgU.js";import{b as D,j as e,H as B,bb as y,z as L,aD as V,aE as z,ax as I,t as T,N as O,cQ as H,_ as g,J as b,r as P,bz as x,a1 as U,d8 as $,d9 as K,da as G,T as J,a6 as Y,B as E,aI as Q,a_ as q,ay as W,az as X}from"./index-BcvhWi3G.js";var Z=I({key:X(),disabled:W().optional(),value:q()}),ee=I({metadata:Q(Z)}),oe=l=>{const{t:i}=D(),{isPending:a,...t}=l;return e.jsxs(o,{children:[e.jsxs(o.Header,{children:[e.jsx(o.Title,{asChild:!0,children:e.jsx(B,{children:i("metadata.edit.header")})}),e.jsx(o.Description,{className:"sr-only",children:i("metadata.edit.description")})]}),a?e.jsx(se,{}):e.jsx(ae,{...t})]})},k="metadata-form-key-label",A="metadata-form-value-label",ae=({metadata:l,hook:i,isMutating:a})=>{const{t}=D(),{handleSuccess:c}=_(),u=L(),r=ie(l),s=V({defaultValues:{metadata:te(l)},resolver:z(ee)}),p=s.handleSubmit(async n=>{const d=le(n,l);await i({metadata:d},{onSuccess:()=>{T.success(t("metadata.edit.successToast")),c()},onError:m=>{T.error(m.message)}})}),{fields:h,insert:w,remove:R}=O({control:s.control,name:"metadata"});function C(n){R(n),h.length===1&&w(0,{key:"",value:"",disabled:!1})}function N(n,d){w(n+(d==="above"?0:1),{key:"",value:"",disabled:!1})}return e.jsx(o.Form,{form:s,children:e.jsxs(M,{onSubmit:p,className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs(o.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[e.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[e.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:k,children:t("metadata.edit.labels.key")})}),e.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:e.jsx("label",{id:A,children:t("metadata.edit.labels.value")})})]}),h.map((n,d)=>{const m=n.disabled||!1;let f="-";return typeof n.value=="object"&&(f="{ ... }"),Array.isArray(n.value)&&(f="[ ... ]"),e.jsx(H,{showTooltip:m,content:t("metadata.edit.complexRow.tooltip"),children:e.jsxs("div",{className:"group/table relative",children:[e.jsxs("div",{className:g("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":d===h.length-1}),children:[e.jsx(b.Field,{control:s.control,name:`metadata.${d}.key`,render:({field:j})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":k,...j,disabled:m,placeholder:"Key"})})})}),e.jsx(b.Field,{control:s.control,name:`metadata.${d}.value`,render:({field:{value:j,...S}})=>e.jsx(b.Item,{children:e.jsx(b.Control,{children:e.jsx(v,{"aria-labelledby":A,...S,value:m?f:j,disabled:m,placeholder:"Value"})})})})]}),e.jsxs(x,{dir:u,children:[e.jsx(x.Trigger,{className:g("invisible absolute inset-y-0 -end-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:m}),disabled:m,asChild:!0,children:e.jsx(U,{size:"2xsmall",children:e.jsx($,{})})}),e.jsxs(x.Content,{children:[e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>N(d,"above"),children:[e.jsx(K,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowAbove")]}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>N(d,"below"),children:[e.jsx(G,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowBelow")]}),e.jsx(x.Separator,{}),e.jsxs(x.Item,{className:"gap-x-2",onClick:()=>C(d),children:[e.jsx(J,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.deleteRow")]})]})]})]})},n.id)})]}),r&&e.jsx(Y,{variant:"warning",label:t("metadata.edit.complexRow.label"),children:t("metadata.edit.complexRow.description")})]}),e.jsx(o.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(o.Close,{asChild:!0,children:e.jsx(E,{size:"small",variant:"secondary",type:"button",disabled:a,children:t("actions.cancel")})}),e.jsx(E,{size:"small",type:"submit",isLoading:a,children:t("actions.save")})]})})]})})},v=P.forwardRef(({className:l,...i},a)=>e.jsx("input",{ref:a,...i,autoComplete:"off",className:g("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",l)}));v.displayName="MetadataForm.GridInput";var se=()=>e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(o.Body,{children:e.jsx(y,{className:"h-[148ox] w-full rounded-lg"})}),e.jsx(o.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(y,{className:"h-7 w-12 rounded-md"}),e.jsx(y,{className:"h-7 w-12 rounded-md"})]})})]}),F=["string","number","boolean"];function te(l){return!l||!Object.keys(l).length?[{key:"",value:"",disabled:!1}]:Object.entries(l).map(([i,a])=>{if(!F.includes(typeof a))return{key:i,value:a,disabled:!0};let t=a;return typeof a!="string"&&(t=JSON.stringify(a)),{key:i,value:t,original_key:i}})}function le(l,i){const a=l.metadata;if(!a.length||a.length===1&&!a[0].key&&!a[0].value)return null;const c={};return i&&Object.keys(i).forEach(u=>{a.some(s=>s.key===u)||(c[u]="")}),a.forEach(u=>{let r=u.key,s=u.value;const p=u.disabled;if(r){if(p){c[r]=s;return}r=r.trim(),s=(s==null?void 0:s.trim())??"",s==="true"?c[r]=!0:s==="false"?c[r]=!1:/^-?\d*\.?\d+$/.test(s)?c[r]=parseFloat(s):c[r]=s}}),c}function ie(l){return l?Object.values(l).some(i=>!F.includes(typeof i)):!1}export{oe as M};
