import{u as re}from"./chunk-DZWH2RV6-DwC22Jxm.js";import{b as L,au as Z,r as h,j as e,aM as A,bK as se,B as oe,bL as J,aP as H,_ as O,bJ as ae,aR as Y,$ as B,K as U,bM as G,a5 as z,bN as q,bO as E,a2 as ne,bP as ce,aN as ue,bQ as de}from"./index-DsV72Lgh.js";import{R as me,I as pe,a as ge}from"./index-Do-4R60H.js";var le=h.createContext(null),K=()=>{const t=h.useContext(le);if(!t)throw new Error("useDataTableFacetedFilterContext must be used within a DataTableFacetedFilter");return t},Q=({param:t,prefix:l,multiple:s=!1})=>{const[v,c]=Z(),r=l?`${l}_${t}`:t,x=l?`${l}_offset`:"offset";return{add:i=>{c(p=>{const j=new URLSearchParams(p);return s?(()=>{var b;const o=((b=j.get(r))==null?void 0:b.split(","))||[];o.includes(i)||(o.push(i),j.set(r,o.join(",")))})():(()=>{j.set(r,i)})(),j.delete(x),j})},delete:i=>{const p=m=>{var b;const a=((b=m.get(r))==null?void 0:b.split(","))||[],o=a.indexOf(i||"");o>-1&&(a.splice(o,1),m.set(r,a.join(",")))},j=m=>{m.delete(r)};c(m=>(i?(s?p(m):j(m),m.get(r)||m.delete(r)):m.delete(r),m.delete(x),m))},get:()=>{var i;return((i=v.get(r))==null?void 0:i.split(",").filter(Boolean))||[]}}},he=({hadPreviousValue:t,label:l,value:s,readonly:v,hasOperator:c,onRemove:r})=>{const{t:x}=L(),u=y=>{y.stopPropagation(),r()};return e.jsxs("div",{className:"bg-ui-bg-field transition-fg shadow-borders-base text-ui-fg-subtle flex cursor-default select-none items-stretch overflow-hidden rounded-md",children:[!t&&e.jsx(ue,{}),e.jsx("div",{className:O("flex items-center justify-center whitespace-nowrap px-2 py-1",{"border-r":!!(s||t)}),children:e.jsx(z,{size:"small",weight:"plus",leading:"compact",children:l})}),e.jsxs("div",{className:"flex w-full items-center overflow-hidden",children:[c&&!!(s||t)&&e.jsx("div",{className:"border-r p-1 px-2",children:e.jsx(z,{size:"small",weight:"plus",leading:"compact",className:"text-ui-fg-muted",children:x("general.is")})}),!!(s||t)&&e.jsx(se,{asChild:!0,className:O("flex-1 cursor-pointer overflow-hidden border-r p-1 px-2",{"hover:bg-ui-bg-field-hover":!v,"data-[state=open]:bg-ui-bg-field-hover":!v}),children:e.jsx(z,{size:"small",leading:"compact",weight:"plus",className:"truncate text-nowrap",children:s||"Â "})})]}),!v&&!!(s||t)&&e.jsx("button",{onClick:u,className:O("text-ui-fg-muted transition-fg flex items-center justify-center p-1","hover:bg-ui-bg-subtle-hover","active:bg-ui-bg-subtle-pressed active:text-ui-fg-base"),children:e.jsx(ne,{})})]})},W=he,xe=({filter:t,prefix:l,readonly:s,openOnMount:v})=>{const[c,r]=h.useState(v),[x,u]=h.useState(!1),{getFullDate:y}=re(),{key:N,label:i}=t,{removeFilter:p}=K(),j=Q({param:N,prefix:l}),m=be(),a=n=>{j.add(JSON.stringify(n)),u(!1)},o=()=>{j.delete(),u(n=>!n)},b=j.get(),g=fe(b),S=ee(g,"$gte"),C=ee(g,"$lte"),V=(n,D)=>{const M=D==="start"?"$gte":"$lte";let R=n;M==="$lte"&&n&&(R=new Date(n.getTime()),R.setHours(23,59,59,999)),j.add(JSON.stringify({...g||{},[M]:R==null?void 0:R.toISOString()}))},T=()=>{const n=m.find(D=>de(D.value,g));return n==null?void 0:n.label},_=n=>n?y({date:n}):void 0,k=()=>[S,C].map(_).filter(Boolean).join(" - "),P=T()||k(),[$,f]=h.useState(P),F=()=>{j.delete(),p(N)};let w=null;const d=n=>{r(n),f(P),w&&clearTimeout(w),!n&&!b.length&&(w=setTimeout(()=>{p(N)},200))};return e.jsxs(A,{modal:!0,open:c,onOpenChange:d,children:[e.jsx(W,{hadPreviousValue:!!$,label:i,value:P,onRemove:F,readonly:s}),!s&&e.jsx(J,{children:e.jsxs(H,{"data-name":"date_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout h-full max-h-[var(--radix-popper-available-height)] w-[300px] overflow-auto rounded-lg"),onInteractOutside:n=>{var D;n.target instanceof HTMLElement&&((D=n.target.attributes.getNamedItem("data-name"))==null?void 0:D.value)==="filters_menu_content"&&n.preventDefault()},children:[e.jsxs("ul",{className:"w-full p-1",children:[m.map(n=>{const D=j.get().includes(JSON.stringify(n.value));return e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:()=>{a(n.value)},children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!D}),children:e.jsx(Y,{})}),n.label]})},n.label)}),e.jsx("li",{children:e.jsxs("button",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex w-full cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",type:"button",onClick:o,children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!x}),children:e.jsx(Y,{})}),G("filters.date.custom")]})})]}),x&&e.jsxs("div",{className:"border-t px-1 pb-3 pt-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx(z,{size:"xsmall",leading:"compact",weight:"plus",children:G("filters.date.from")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(q,{modal:!0,maxValue:C,value:S,onChange:n=>V(n,"start")})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1",children:e.jsx(z,{size:"xsmall",leading:"compact",weight:"plus",children:G("filters.date.to")})}),e.jsx("div",{className:"px-2 py-1",children:e.jsx(q,{modal:!0,minValue:S,value:C||void 0,onChange:n=>{V(n,"end")}})})]})]})]})})]})},I=new Date;I.setHours(0,0,0,0);var be=()=>{const{t}=L();return h.useMemo(()=>[{label:t("filters.date.today"),value:{$gte:I.toISOString()}},{label:t("filters.date.lastSevenDays"),value:{$gte:new Date(I.getTime()-7*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastThirtyDays"),value:{$gte:new Date(I.getTime()-30*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastNinetyDays"),value:{$gte:new Date(I.getTime()-90*24*60*60*1e3).toISOString()}},{label:t("filters.date.lastTwelveMonths"),value:{$gte:new Date(I.getTime()-365*24*60*60*1e3).toISOString()}}],[t])},fe=t=>t!=null&&t.length?JSON.parse(t.join(",")):null,ee=(t,l)=>{if(!(t!=null&&t[l]))return;const s=new Date(t[l]);return l==="$lte"&&s.setHours(0,0,0,0),s},ve=({filter:t,prefix:l,readonly:s,openOnMount:v})=>{const{t:c}=L(),[r,x]=h.useState(v),{key:u,label:y}=t,{removeFilter:N}=K(),i=Q({param:u,prefix:l,multiple:!1}),p=i.get(),[j,m]=h.useState(p),[a,o]=h.useState(je(p)),b=h.useCallback(ae((f,F)=>{const w=f.target.value,d=JSON.parse((p==null?void 0:p.join(","))||"{}"),n=!isNaN(Number(d)),D=M=>{if(!w&&n){i.delete();return}if(d&&!w){delete d[M],i.add(JSON.stringify(d));return}if(!d){i.add(JSON.stringify({[M]:w}));return}i.add(JSON.stringify({...d,[M]:w}))};switch(F){case"eq":w?i.add(w):i.delete();break;case"lt":case"gt":D(F);break}},500),[i,p]);h.useEffect(()=>()=>{b.cancel()},[b]);let g=null;const S=f=>{x(f),m(p),g&&clearTimeout(g),!f&&!p.length&&(g=setTimeout(()=>{N(u)},200))},C=()=>{i.delete(),N(u)},V=[{operator:"exact",label:c("filters.compare.exact")},{operator:"range",label:c("filters.compare.range")}],T=`${u}-gt`,_=`${u}-lt`,k=u,P=te(p,c),$=te(j,c);return e.jsxs(A,{modal:!0,open:r,onOpenChange:S,children:[e.jsx(W,{hasOperator:!0,hadPreviousValue:!!$,label:y,value:P,onRemove:C,readonly:s}),!s&&e.jsx(J,{children:e.jsxs(H,{"data-name":"number_filter_content",align:"start",sideOffset:8,collisionPadding:24,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout max-h-[var(--radix-popper-available-height)] w-[300px] divide-y overflow-y-auto rounded-lg outline-none"),onInteractOutside:f=>{var F;f.target instanceof HTMLElement&&((F=f.target.attributes.getNamedItem("data-name"))==null?void 0:F.value)==="filters_menu_content"&&f.preventDefault()},children:[e.jsx("div",{className:"p-1",children:e.jsx(me,{value:a,onValueChange:f=>o(f),className:"flex flex-col items-start",orientation:"vertical",autoFocus:!0,children:V.map(f=>e.jsxs(pe,{value:f.operator,className:"txt-compact-small hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed transition-fg grid w-full grid-cols-[20px_1fr] gap-2 rounded-[4px] px-2 py-1.5 text-left outline-none",children:[e.jsx("div",{className:"size-5",children:e.jsx(ge,{children:e.jsx(Y,{})})}),e.jsx("span",{className:"w-full",children:f.label})]},f.operator))})}),e.jsx("div",{children:a==="range"?e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:T,children:c("filters.compare.greaterThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(U,{name:T,size:"small",type:"number",defaultValue:X(p,"gt"),onChange:f=>b(f,"gt")})}),e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:_,children:c("filters.compare.lessThan")})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(U,{name:_,size:"small",type:"number",defaultValue:X(p,"lt"),onChange:f=>b(f,"lt")})})]},"range"):e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:k,children:y})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(U,{name:k,size:"small",type:"number",defaultValue:X(p,"eq"),onChange:f=>b(f,"eq")})})]},"exact")})]})})]})},te=(t,l)=>{const s=JSON.parse((t==null?void 0:t.join(","))||"{}");let v="";if(typeof s=="object"){const c=[];s.gt&&c.push(l("filters.compare.greaterThanLabel",{value:s.gt})),s.lt&&c.push(l("filters.compare.lessThanLabel",{value:s.lt})),v=c.join(` ${l("filters.compare.andLabel")} `)}return typeof s=="number"&&(v=s.toString()),v},ie=t=>{if(!t)return;const l=t.join(",");if(l)return JSON.parse(l)},X=(t,l)=>{const s=ie(t);if(typeof s=="object")return s[l];if(typeof s=="number"&&l==="eq")return s},je=t=>typeof ie(t)=="object"?"range":"exact",ye=({filter:t,prefix:l,readonly:s,multiple:v,searchable:c,options:r,openOnMount:x})=>{const[u,y]=h.useState(x),[N,i]=h.useState(""),[p,j]=h.useState(null),{t:m}=L(),{removeFilter:a}=K(),{key:o,label:b}=t,g=Q({param:o,prefix:l,multiple:v}),S=g.get(),C=S.map(d=>{var n;return(n=r.find(D=>D.value===d))==null?void 0:n.label}).filter(Boolean),[V,T]=h.useState(C),_=()=>{g.delete(),a(o)};let k=null;const P=d=>{y(d),T(C),k&&clearTimeout(k),!d&&!S.length&&(k=setTimeout(()=>{a(o)},200))},$=()=>{i(""),p&&p.focus()},f=d=>{g.get().includes(String(d))?g.delete(String(d)):g.add(String(d))},F=C?Array.isArray(C)?C:[C]:null,w=V?Array.isArray(V)?V:[V]:null;return e.jsxs(A,{modal:!0,open:u,onOpenChange:P,children:[e.jsx(W,{hasOperator:!0,hadPreviousValue:!!(w!=null&&w.length),readonly:s,label:b,value:F==null?void 0:F.join(", "),onRemove:_}),!s&&e.jsx(J,{children:e.jsx(H,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:d=>{var n;d.target instanceof HTMLElement&&((n=d.target.attributes.getNamedItem("data-name"))==null?void 0:n.value)==="filters_menu_content"&&(d.preventDefault(),d.stopPropagation())},children:e.jsxs(E,{className:"h-full",children:[c&&e.jsx("div",{className:"border-b p-1",children:e.jsxs("div",{className:"grid grid-cols-[1fr_20px] gap-x-2 rounded-md px-2 py-1",children:[e.jsx(E.Input,{ref:j,value:N,onValueChange:i,className:"txt-compact-small placeholder:text-ui-fg-muted bg-transparent outline-none",placeholder:"Search"}),e.jsx("div",{className:"flex h-5 w-5 items-center justify-center",children:e.jsx("button",{disabled:!N,onClick:$,className:O("transition-fg text-ui-fg-muted focus-visible:bg-ui-bg-base-pressed rounded-md outline-none",{invisible:!N}),children:e.jsx(ne,{})})})]})}),e.jsx(E.Empty,{className:"txt-compact-small flex items-center justify-center p-1",children:e.jsx("span",{className:"w-full px-2 py-1 text-center",children:m("general.noResultsTitle")})}),e.jsx(E.List,{className:"h-full max-h-[163px] min-h-[0] overflow-auto p-1 outline-none",children:r.map(d=>{const n=g.get().includes(String(d.value));return e.jsxs(E.Item,{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover aria-selected:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center gap-x-2 rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",value:d.label,onSelect:()=>{f(d.value)},children:[e.jsx("div",{className:O("transition-fg flex h-5 w-5 items-center justify-center",{"[&_svg]:invisible":!n}),children:v?e.jsx(ce,{}):e.jsx(Y,{})}),d.label]},String(d.value))})})]})})})]})},Ne=({filter:t,prefix:l,readonly:s,openOnMount:v})=>{const[c,r]=h.useState(v),{key:x,label:u}=t,{removeFilter:y}=K(),N=Q({param:x,prefix:l}),i=N.get(),[p,j]=h.useState(i==null?void 0:i[0]),m=h.useCallback(ae(g=>{const S=g.target.value;S?N.add(S):N.delete()},500),[N]);h.useEffect(()=>()=>{m.cancel()},[m]);let a=null;const o=g=>{r(g),j(i==null?void 0:i[0]),a&&clearTimeout(a),!g&&!i.length&&(a=setTimeout(()=>{y(x)},200))},b=()=>{N.delete(),y(x)};return e.jsxs(A,{modal:!0,open:c,onOpenChange:o,children:[e.jsx(W,{hasOperator:!0,hadPreviousValue:!!p,label:u,value:i==null?void 0:i[0],onRemove:b,readonly:s}),!s&&e.jsx(J,{children:e.jsx(H,{hideWhenDetached:!0,align:"start",sideOffset:8,collisionPadding:8,className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-hidden rounded-lg outline-none"),onInteractOutside:g=>{var S;g.target instanceof HTMLElement&&((S=g.target.attributes.getNamedItem("data-name"))==null?void 0:S.value)==="filters_menu_content"&&(g.preventDefault(),g.stopPropagation())},children:e.jsxs("div",{className:"px-1 pb-3 pt-1",children:[e.jsx("div",{className:"px-2 py-1.5",children:e.jsx(B,{size:"xsmall",weight:"plus",htmlFor:x,children:u})}),e.jsx("div",{className:"px-2 py-0.5",children:e.jsx(U,{name:x,size:"small",defaultValue:(i==null?void 0:i[0])||void 0,onChange:m})})]})})})]})},Fe=({filters:t,readonly:l,prefix:s})=>{const{t:v}=L(),[c]=Z(),[r,x]=h.useState(!1),[u,y]=h.useState(we({searchParams:c,filters:t,prefix:s})),N=t.filter(a=>!u.find(o=>o.key===a.key)),i=h.useRef(!0);h.useEffect(()=>{if(i.current){const a=new URLSearchParams(c);t.forEach(o=>{const b=s?`${s}_${o.key}`:o.key;a.get(b)&&!u.find(S=>S.key===o.key)&&(o.type==="select"?y(S=>[...S,{...o,multiple:o.multiple,options:o.options,openOnMount:!1}]):y(S=>[...S,{...o,openOnMount:!1}]))})}i.current=!1},[u,t,s,c]);const p=a=>{x(!1),y(o=>[...o,{...a,openOnMount:!0}])},j=h.useCallback(a=>{y(o=>o.filter(b=>b.key!==a))},[]),m=h.useCallback(()=>{y([])},[]);return e.jsx(le.Provider,{value:h.useMemo(()=>({removeFilter:j,removeAllFilters:m}),[m,j]),children:e.jsxs("div",{className:"max-w-2/3 flex flex-wrap items-center gap-2",children:[u.map(a=>{switch(a.type){case"select":return e.jsx(ye,{filter:a,prefix:s,readonly:l,options:a.options,multiple:a.multiple,searchable:a.searchable,openOnMount:a.openOnMount},a.key);case"date":return e.jsx(xe,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key);case"string":return e.jsx(Ne,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key);case"number":return e.jsx(ve,{filter:a,prefix:s,readonly:l,openOnMount:a.openOnMount},a.key)}}),!l&&N.length>0&&e.jsxs(A,{modal:!0,open:r,onOpenChange:x,children:[e.jsx(se,{asChild:!0,id:"filters_menu_trigger",children:e.jsx(oe,{size:"small",variant:"secondary",children:v("filters.addFilter")})}),e.jsx(J,{children:e.jsx(H,{className:O("bg-ui-bg-base text-ui-fg-base shadow-elevation-flyout z-[1] h-full max-h-[200px] w-[300px] overflow-auto rounded-lg p-1 outline-none"),"data-name":"filters_menu_content",align:"start",sideOffset:8,collisionPadding:8,onCloseAutoFocus:a=>{u.find(b=>b.openOnMount)&&a.preventDefault()},children:N.map(a=>e.jsx("div",{className:"bg-ui-bg-base hover:bg-ui-bg-base-hover focus-visible:bg-ui-bg-base-pressed text-ui-fg-base data-[disabled]:text-ui-fg-disabled txt-compact-small relative flex cursor-pointer select-none items-center rounded-md px-2 py-1.5 outline-none transition-colors data-[disabled]:pointer-events-none",role:"menuitem",onClick:()=>{p(a)},children:a.label},a.key))})})]}),!l&&u.length>0&&e.jsx(Se,{filters:t,prefix:s})]})})},Se=({filters:t,prefix:l})=>{const{removeAllFilters:s}=K(),[v,c]=Z(),r=()=>{c(x=>{const u=new URLSearchParams(x);return t.forEach(y=>{u.delete(l?`${l}_${y.key}`:y.key)}),u}),s()};return e.jsx("button",{type:"button",onClick:r,className:O("text-ui-fg-muted transition-fg txt-compact-small-plus rounded-md px-2 py-1","hover:text-ui-fg-subtle","focus-visible:shadow-borders-focus"),children:"Clear all"})},we=({searchParams:t,filters:l,prefix:s})=>{const v=new URLSearchParams(t),c=[];return l.forEach(r=>{const x=s?`${s}_${r.key}`:r.key;v.get(x)&&(r.type==="select"?c.push({...r,multiple:r.multiple,options:r.options,openOnMount:!1}):c.push({...r,openOnMount:!1}))}),c};export{Fe as D,Q as u};
