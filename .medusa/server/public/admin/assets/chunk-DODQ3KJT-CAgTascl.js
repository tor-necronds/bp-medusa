import{o as b,a as x}from"./chunk-ZQRKUG6J-C7OcWeCb.js";import{F as S}from"./chunk-BYOPZAGX-DwJgWMZr.js";import{c as T}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{ax as h,aI as p,ay as c,az as e,aY as w,aZ as I,a_ as q,aH as j,aK as P,b as C,r as F,j as d,J as y}from"./index-BcvhWi3G.js";var A=i=>{var t,n,k,l,u,m,g,f,s,_;const a=(n=(t=i.media)==null?void 0:t.find(r=>r.isThumbnail))==null?void 0:n.url,o=(k=i.media)==null?void 0:k.filter(r=>!r.isThumbnail).map(r=>({url:r.url}));return{status:i.status,is_giftcard:!1,tags:(l=i==null?void 0:i.tags)!=null&&l.length?(u=i.tags)==null?void 0:u.map(r=>({id:r})):void 0,sales_channels:(m=i==null?void 0:i.sales_channels)!=null&&m.length?(g=i.sales_channels)==null?void 0:g.map(r=>({id:r.id})):void 0,images:o,collection_id:i.collection_id||void 0,shipping_profile_id:i.shipping_profile_id||void 0,categories:i.categories.map(r=>({id:r})),type_id:i.type_id||void 0,handle:(f=i.handle)==null?void 0:f.trim(),origin_country:i.origin_country||void 0,material:i.material||void 0,mid_code:i.mid_code||void 0,hs_code:i.hs_code||void 0,thumbnail:a,title:i.title.trim(),subtitle:(s=i.subtitle)==null?void 0:s.trim(),description:(_=i.description)==null?void 0:_.trim(),discountable:i.discountable,width:i.width?parseFloat(i.width):void 0,length:i.length?parseFloat(i.length):void 0,height:i.height?parseFloat(i.height):void 0,weight:i.weight?parseFloat(i.weight):void 0,options:i.options.filter(r=>r.title),variants:D(i.variants.filter(r=>r.should_create),i.regionsCurrencyMap)}},D=(i,a)=>i.map(o=>({title:o.title||Object.values(o.options||{}).join(" / "),options:o.options,sku:o.sku||void 0,manage_inventory:!!o.manage_inventory,allow_backorder:!!o.allow_backorder,variant_rank:o.variant_rank,inventory_items:o.inventory.map(t=>{const n=t.required_quantity?T(t.required_quantity):null;return!t.inventory_item_id||!n?!1:{...t,required_quantity:n}}).filter(t=>t!==!1),prices:Object.entries(o.prices||{}).map(([t,n])=>{if(!(n===""||n===void 0))return t.startsWith("reg_")?{currency_code:a[t],amount:T(n),rules:{region_id:t}}:{currency_code:t,amount:T(n)}}).filter(t=>!!t)})),O=i=>i.map(a=>({...a,title:a.title||"",sku:a.sku||"",manage_inventory:a.manage_inventory||!1,allow_backorder:a.allow_backorder||!1,inventory_kit:a.inventory_kit||!1})),v=h({id:e().optional(),url:e(),isThumbnail:c(),file:q().nullable()}),R=h({should_create:c(),is_default:c().optional(),title:e(),upc:e().optional(),ean:e().optional(),barcode:e().optional(),mid_code:e().optional(),hs_code:e().optional(),width:b,height:b,length:b,weight:b,material:e().optional(),origin_country:e().optional(),sku:e().optional(),manage_inventory:c().optional(),allow_backorder:c().optional(),inventory_kit:c().optional(),options:j(e(),e()),variant_rank:P(),prices:j(e(),x).optional(),inventory:p(h({inventory_item_id:e(),required_quantity:b})).optional()}),M=h({title:e(),values:p(e()).min(1)}),H=h({title:e().min(1),subtitle:e().optional(),handle:e().optional(),description:e().optional(),discountable:c(),type_id:e().optional(),collection_id:e().optional(),shipping_profile_id:e().optional(),categories:p(e()),tags:p(e()).optional(),sales_channels:p(h({id:e(),name:e()})).optional(),origin_country:e().optional(),material:e().optional(),width:e().optional(),length:e().optional(),height:e().optional(),weight:e().optional(),mid_code:e().optional(),hs_code:e().optional(),options:p(M).min(1),enable_variants:c(),variants:p(R).min(1),media:p(v).optional()}).superRefine((i,a)=>{if(i.variants.every(t=>!t.should_create))return a.addIssue({code:w.custom,path:["variants"],message:"invalid_length"});const o=new Set;i.variants.forEach((t,n)=>{t.sku&&(o.has(t.sku)&&a.addIssue({code:w.custom,path:[`variants.${n}.sku`],message:I.t("products.create.errors.uniqueSku")}),o.add(t.sku))})}),W=h({media:p(v)}),Z={discountable:!0,tags:[],sales_channels:[],options:[{title:"Default option",values:["Default option value"]}],variants:O([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]),enable_variants:!1,media:[],categories:[],collection_id:"",shipping_profile_id:"",description:"",handle:"",height:"",hs_code:"",length:"",material:"",mid_code:"",origin_country:"",subtitle:"",title:"",type_id:"",weight:"",width:""},E=["image/jpeg","image/png","image/gif","image/webp","image/heic","image/svg+xml"],U=[".jpeg",".png",".gif",".webp",".heic",".svg"],B=({form:i,append:a,showHint:o=!0})=>{const{t}=C(),n=F.useCallback((l=[],u=[])=>{const m=l.find(s=>{var _;return!E.includes((_=s==null?void 0:s.file)==null?void 0:_.type)});let g=!1;m&&(i.setError("media",{type:"invalid_file",message:t("products.media.invalidFileType",{name:m.file.name,types:U.join(", ")})}),g=!0);const f=u.filter(s=>(s==null?void 0:s.reason)==="size");if(f.length){const s=`
`+f.slice(0,5).map(_=>_.file.name).join(`
`);i.setError("media",{type:"file_too_large",message:t("products.media.fileTooLarge",{name:s,size:"1MB"})}),g=!0}return g},[i,t]),k=F.useCallback((l=[],u=[])=>{i.clearErrors("media"),!n(l,u)&&(l==null||l.forEach(m=>a({...m,isThumbnail:!1})))},[i,a,n]);return d.jsx(y.Field,{control:i.control,name:"media",render:()=>d.jsx(y.Item,{children:d.jsxs("div",{className:"flex flex-col gap-y-2",children:[d.jsxs("div",{className:"flex flex-col gap-y-1",children:[d.jsx(y.Label,{optional:!0,children:t("products.media.label")}),o&&d.jsx(y.Hint,{children:t("products.media.editHint")})]}),d.jsx(y.Control,{children:d.jsx(S,{label:t("products.media.uploadImagesLabel"),hint:t("products.media.uploadImagesHint"),hasError:!!i.formState.errors.media,formats:E,onUploaded:k})}),d.jsx(y.ErrorMessage,{className:"whitespace-pre-line"})]})})})};export{W as E,H as P,B as U,Z as a,O as d,A as n};
