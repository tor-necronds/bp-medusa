import{t as oe}from"./chunk-6CPMXY5N-BnsD9cSz.js";import{T as le,D as ce}from"./chunk-3I6G3NRU-5iTXObfw.js";import{D as ue}from"./chunk-ROKB75YP-doOiTN2B.js";import{M as de}from"./chunk-INE2QCSC-DSgZPtoY.js";import{P as fe,S as ge,C as me,V as _e}from"./chunk-XLDQPLK4-J0yMuq5Z.js";import{P as he}from"./chunk-IQBAUTU5-cxpITxb6.js";import{D as ye,S as pe,u as be,a as Ce}from"./chunk-TBEGSDLQ-CqlmjLt4.js";import{u as Se}from"./chunk-C76H5USB-D2gMrc88.js";import{b as W,r as p,j as u,B as X,C as ve,d as je,au as xe,by as Ae,ab as De,h as Oe,bz as $,bA as Ne,aj as Ee,ao as G,bB as Re,al as Te}from"./index-BcvhWi3G.js";import{R as we}from"./react-country-flag.esm-BkTB3IRy.js";var Fe=({isDefaultView:e,currentViewId:t,currentViewName:r,onSaveAsDefault:n,onUpdateExisting:i,onSaveAsNew:s})=>{const{t:a}=W(),f=Oe(),c=async()=>{await f({title:a("views.prompts.updateDefault.title"),description:a("views.prompts.updateDefault.description"),confirmText:a("views.prompts.updateDefault.confirmText"),cancelText:a("views.prompts.updateDefault.cancelText")})&&n()},C=async()=>{await f({title:a("views.prompts.updateView.title"),description:a("views.prompts.updateView.description",{name:r}),confirmText:a("views.prompts.updateView.confirmText"),cancelText:a("views.prompts.updateView.cancelText")})&&i()};return u.jsxs($,{children:[u.jsx($.Trigger,{asChild:!0,children:u.jsxs(X,{variant:"secondary",size:"small",type:"button",children:[a("views.save"),u.jsx(Ne,{})]})}),u.jsx($.Content,{align:"end",children:e?u.jsxs(u.Fragment,{children:[u.jsx($.Item,{onClick:c,children:a("views.updateDefaultForEveryone")}),u.jsx($.Item,{onClick:s,children:a("views.saveAsNew")})]}):u.jsxs(u.Fragment,{children:[u.jsx($.Item,{onClick:C,children:a("views.updateViewName")}),u.jsx($.Item,{onClick:s,children:a("views.saveAsNew")})]})})]})};function $e(e,t){const[r,n]=p.useState(()=>{if(e!=null&&e.length&&(t!=null&&t.configuration)){const o={};return e.forEach(l=>{var g;o[l.field]=((g=t.configuration.visible_columns)==null?void 0:g.includes(l.field))||!1}),o}else if(e!=null&&e.length)return V(e);return{}}),[i,s]=p.useState(()=>{var o;return(o=t==null?void 0:t.configuration)!=null&&o.column_order?t.configuration.column_order:e!=null&&e.length?J(e):[]}),a=p.useMemo(()=>({visibility:r,order:i}),[r,i]),f=p.useMemo(()=>({visible:Object.entries(r).filter(([l,g])=>g).map(([l])=>l),order:i}),[r,i]),c=p.useCallback(o=>{n(o)},[]),C=p.useCallback((o,l)=>{if(o!=null&&o.configuration){const g={};l.forEach(x=>{var v;g[x.field]=((v=o.configuration.visible_columns)==null?void 0:v.includes(x.field))||!1}),n(g),s(o.configuration.column_order||[])}else n(V(l)),s(J(l))},[]),m=p.useCallback(o=>{Object.keys(r).length===0&&n(V(o)),i.length===0&&s(J(o))},[]),S=p.useRef();return p.useEffect(()=>{var o,l,g;if(e!=null&&e.length){const x=((o=S.current)==null?void 0:o.id)!==(t==null?void 0:t.id),v=t&&((l=S.current)==null?void 0:l.id)===t.id&&S.current.updated_at!==t.updated_at;if(x||v)if(t!=null&&t.configuration){const h={};e.forEach(T=>{var O,w;h[T.field]=((w=(O=t.configuration)==null?void 0:O.visible_columns)==null?void 0:w.includes(T.field))||!1}),n(h),s(((g=t.configuration)==null?void 0:g.column_order)||[])}else n(V(e)),s(J(e))}S.current=t},[t,e]),{visibleColumns:r,columnOrder:i,columnState:a,currentColumns:f,setVisibleColumns:n,setColumnOrder:s,handleColumnVisibilityChange:c,handleViewChange:C,initializeColumns:m}}var K=500;function V(e){if(!e||e.length===0)return{};const t={};return e.forEach(r=>{t[r.field]=r.default_visible??!0}),t}function J(e){return!e||e.length===0?[]:[...e].sort((r,n)=>{const i=r.default_order??K,s=n.default_order??K;return i-s}).map(r=>r.field)}var Q={orders:{properties:["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],relations:["*customer","*sales_channel"]},products:{properties:["id","title","handle","status","thumbnail"],relations:["collection.title","*sales_channels","*variants"]},customers:{properties:["id","email","first_name","last_name","created_at","updated_at","has_account"],relations:["*groups"]},inventory:{properties:["id","sku","title","description","stocked_quantity","reserved_quantity","created_at","updated_at"],relations:["*location_levels"]},default:{properties:["id","created_at","updated_at"],relations:[]}};function ke(e){const t=Q[e]||Q.default;return{properties:t.properties,relations:t.relations,formatted:[...t.properties,...t.relations].join(",")}}function Ie(e,t,r){const n=ke(e),i=n.formatted;if(!(t!=null&&t.length))return i;const s=t.filter(l=>Object.keys(r).length>0?r[l.field]===!0:l.default_visible),a=new Set;s.forEach(l=>{var g,x;l.computed?((g=l.computed.required_fields)==null||g.forEach(v=>a.add(v)),(x=l.computed.optional_fields)==null||x.forEach(v=>a.add(v))):(l.field.includes("."),a.add(l.field))});const f=Array.from(a),c=f.filter(l=>l.includes(".")),C=f.filter(l=>!l.includes(".")),m=c.filter(l=>{const[g]=l.split(".");return!n.relations.some(v=>v===`*${g}`||v===g)}),S=C.filter(l=>!n.properties.includes(l)),o=[...m,...S];return o.length>0?`${i},${o.join(",")}`:i}function ze(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}function Me({entity:e,queryPrefix:t="",filters:r=[]}){const n=je("view_configurations"),[i,s]=xe(),{activeView:a,createView:f}=be(e),c=(a==null?void 0:a.view_configuration)||null,{updateView:C}=Ce(e,(c==null?void 0:c.id)||""),{columns:m,isLoading:S}=Ae(e,{enabled:n}),o=Se(["q","order","offset","limit",...r.map(_=>_.id)],t),{visibleColumns:l,columnOrder:g,currentColumns:x,setColumnOrder:v,handleColumnVisibilityChange:h,handleViewChange:T}=$e(m,c);p.useEffect(()=>{m&&(T(c,m),s(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),c){const d=c.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _}))},[c,m]);const O=p.useMemo(()=>{const _={};return r.forEach(y=>{o[y.id]!==void 0&&(_[y.id]=JSON.parse(o[y.id]||""))}),{filters:_,sorting:o.order?ze(o.order):null,search:o.q||""}},[r,o]),[w,L]=p.useState(!1),z=p.useMemo(()=>{const _=O.filters,y=O.sorting,d=O.search,D=Object.entries(l).filter(([j,E])=>E).map(([j])=>j).sort();if(c){const j=c.configuration.filters||{},E=c.configuration.sorting,k=c.configuration.search||"",A=[...c.configuration.visible_columns||[]].sort(),R=c.configuration.column_order||[],q=new Set([...Object.keys(_),...Object.keys(j)]);for(const M of q)if(JSON.stringify(_[M])!==JSON.stringify(j[M]))return!0;const F=y||void 0,B=E||void 0;if(JSON.stringify(F)!==JSON.stringify(B)||d!==k||JSON.stringify(D)!==JSON.stringify(A)||JSON.stringify(g)!==JSON.stringify(R))return!0}else{if(Object.keys(_).length>0||y!==null||d!=="")return!0;if(m){const j=new Set(D),E=new Set(m.filter(A=>A.default_visible).map(A=>A.field));if(j.size!==E.size||[...j].some(A=>!E.has(A)))return!0;const k=m.sort((A,R)=>(A.default_order??500)-(R.default_order??500)).map(A=>A.field);if(JSON.stringify(g)!==JSON.stringify(k))return!0}}return!1},[c,l,g,O,m]);p.useEffect(()=>{const _=setTimeout(()=>{L(z)},50);return()=>clearTimeout(_)},[z]);const N=p.useCallback(()=>{m&&T(c,m),s(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),c!=null&&c.configuration){const d=c.configuration;if(d.filters&&Object.entries(d.filters).forEach(([D,j])=>{_.set(`${t}_${D}`,JSON.stringify(j))}),d.sorting){const D=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,D)}d.search&&_.set(`${t}_q`,d.search)}return _})},[c,m,t]),U=p.useMemo(()=>Ie(e,m,l),[e,m,l]);return{activeView:c,createView:f,updateView:C,isViewConfigEnabled:n,visibleColumns:l,columnOrder:g,currentColumns:x,setColumnOrder:v,handleColumnVisibilityChange:h,currentConfiguration:O,hasConfigurationChanged:w,handleClearConfiguration:N,apiColumns:m,isLoadingColumns:S,queryParams:o,requiredFields:U}}var b=new Map,Ve=(e,t)=>t.split(".").reduce((r,n)=>r==null?void 0:r[n],e),P=(e,t,r,n)=>e==null?"-":String(e),Je=(e,t,r,n)=>{const i=e||[],s=Array.isArray(i)?i.length:0;return n("general.items",{count:s})},Z=(e,t,r,n)=>{if(!e)return"-";if(r.field==="status"&&t.status&&(t.handle||t.is_giftcard!==void 0))return u.jsx(fe,{status:t.status});const i=f=>{switch(f==null?void 0:f.toLowerCase()){case"active":case"published":case"fulfilled":case"paid":return"green";case"pending":case"proposed":case"processing":return"orange";case"draft":return"grey";case"rejected":case"failed":case"canceled":return"red";default:return"grey"}},a=((f,c)=>{if(!n)return f;const C=f.toLowerCase(),m=oe(C);switch(C){case"active":return n("general.active","Active");case"published":return n("products.productStatus.published","Published");case"draft":return n("orders.status.draft","Draft");case"pending":return n("orders.status.pending","Pending");case"canceled":return n("orders.status.canceled","Canceled");default:return c.context==="payment"?n(`orders.payment.status.${m}`,f):c.context==="fulfillment"?n(`orders.fulfillment.status.${m}`,f):n(`status.${C}`,f)}})(e,r);return u.jsx(Ee,{color:i(e),children:a})},ee=(e,t,r,n)=>{if(r.field==="sales_channels_display"||r.field==="sales_channels")return u.jsx(ge,{salesChannels:t.sales_channels});if(!Array.isArray(e))return"-";const i=e.slice(0,2),s=e.length-2;return u.jsxs("div",{className:"flex gap-1",children:[i.map((a,f)=>u.jsx(G,{size:"xsmall",children:typeof a=="string"?a:a.name||a.title||"-"},f)),s>0&&u.jsx(G,{size:"xsmall",color:"grey",children:n?n("general.plusCountMore","+ {{count}} more",{count:s}):`+${s}`})]})},Le=(e,t,r,n)=>u.jsx(he,{product:t}),Ue=(e,t,r,n)=>u.jsx(me,{collection:t.collection}),qe=(e,t,r,n)=>u.jsx(_e,{variants:t.variants}),Be=(e,t,r,n)=>{var i,s,a,f;if((i=t.customer)!=null&&i.first_name||(s=t.customer)!=null&&s.last_name){const c=`${t.customer.first_name||""} ${t.customer.last_name||""}`.trim();if(c)return c}return(a=t.customer)!=null&&a.email?t.customer.email:(f=t.customer)!=null&&f.phone?t.customer.phone:n?n("customers.guest","Guest"):"Guest"},He=(e,t,r,n)=>{let i=null;if(r.field==="shipping_address_display"?i=t.shipping_address:r.field==="billing_address_display"?i=t.billing_address:i=t.shipping_address||t.billing_address,!i)return"-";const s=[];i.address_1&&s.push(i.address_1);const a=[];return i.city&&a.push(i.city),i.province&&a.push(i.province),i.postal_code&&a.push(i.postal_code),a.length>0&&s.push(a.join(", ")),i.country_code&&s.push(i.country_code.toUpperCase()),s.join(" â€¢ ")||"-"},Pe=(e,t,r,n)=>{var f;const i=(f=t.shipping_address)==null?void 0:f.country_code;if(!i)return u.jsx("div",{className:"flex w-full justify-center",children:"-"});const s=Re(i),a=(s==null?void 0:s.display_name)||i.toUpperCase();return u.jsx("div",{className:"flex w-full items-center justify-center",children:u.jsx(Te,{content:a,children:u.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:u.jsx(we,{countryCode:i.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":a})})})})},Y=(e,t,r,n)=>u.jsx(ue,{date:e}),We=(e,t,r,n)=>u.jsx(ce,{displayId:e}),te=(e,t,r,n)=>{const i=t.currency_code||"USD";return u.jsx(de,{currencyCode:i,amount:e,align:"right"})},Ye=(e,t,r,n)=>{const i=t.currency_code||"USD";return u.jsx(le,{currencyCode:i,total:e})};b.set("text",P);b.set("count",Je);b.set("status",Z);b.set("badge_list",ee);b.set("date",Y);b.set("timestamp",Y);b.set("currency",te);b.set("total",Ye);b.set("product_info",Le);b.set("collection",Ue);b.set("variants",qe);b.set("sales_channels_list",ee);b.set("customer_name",Be);b.set("address_summary",He);b.set("country_code",Pe);b.set("display_id",We);function Ge(e,t){if(e&&b.has(e))return b.get(e);switch(t){case"number":case"string":return P;case"date":return Y;case"boolean":return(r,n,i,s)=>s?r?s("fields.yes","Yes"):s("fields.no","No"):r?"Yes":"No";case"enum":return Z;case"currency":return te;default:return P}}function Ke(e,t){return t.computed?e:Ve(e,t.field)}function Qe(e,t,r){const n=De(),{t:i}=W();return p.useMemo(()=>t!=null&&t.length?t.map(s=>{var m;let a=(m=s.computed)==null?void 0:m.type;a||(s.semantic_type==="timestamp"?a="timestamp":s.field==="display_id"?a="display_id":s.field==="total"?a="total":s.semantic_type==="currency"&&(a="currency"));const f=Ge(a,s.data_type),c=r!=null&&r.getColumnAlignment?r.getColumnAlignment(s):Xe(s),C=S=>Ke(S,s);return n.accessor(C,{id:s.field,header:()=>s.name,cell:({getValue:S,row:o})=>{const l=S();if(r!=null&&r.transformCellValue){const g=r.transformCellValue(l,o.original,s);if(g!==null)return g}return f(l,o.original,s,i)},meta:{name:s.name,column:s},enableHiding:s.hideable,enableSorting:s.sortable,headerAlign:c})}):[],[e,t,r,i])}function Xe(e){var t;return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")||e.field.includes("quantity")||e.field.includes("count")?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"||e.field==="country"||e.field.includes("country_code")?"center":"left"}var Ze={getColumnAlignment:e=>{var t;return e.semantic_type==="currency"?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"?"center":"left"}},et={getColumnAlignment:e=>{var t,r,n;return e.field==="product_display"||e.field==="collection.title"||e.field==="sales_channels_display"||e.field==="variants_count"?"left":e.field==="sku"?"center":e.field==="stock"||e.semantic_type==="currency"?"right":(e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="product_info"||((r=e.computed)==null?void 0:r.type)==="count"||((n=e.computed)==null?void 0:n.type)==="sales_channels_list","left")},transformCellValue:(e,t,r)=>{var n,i,s;if(r.field==="variants_count"||((n=r.computed)==null?void 0:n.type)==="count"){const a=Array.isArray(t.variants)?t.variants.length:0;return`${a} ${a===1?"variant":"variants"}`}return r.field==="product_display"||((i=r.computed)==null?void 0:i.type)==="product_info"||r.field==="sales_channels_display"||((s=r.computed)==null?void 0:s.type)==="sales_channels_list"||r.field==="status",null}},tt={getColumnAlignment:e=>e.field==="orders_count"||e.semantic_type==="currency"?"right":e.semantic_type==="status"?"center":"left",transformCellValue:(e,t,r)=>{if(r.field==="name"){const{first_name:n,last_name:i}=t;return n||i?`${n||""} ${i||""}`.trim():"-"}return null}},rt={getColumnAlignment:e=>e.field==="stocked_quantity"||e.field==="reserved_quantity"||e.field==="available_quantity"?"right":e.semantic_type==="status"?"center":"left"},nt={orders:Ze,products:et,customers:tt,inventory:rt};function st(e){return nt[e]}function _t({adapter:e,heading:t,subHeading:r,pageSize:n,queryPrefix:i,layout:s="fill",actions:a}){const{t:f}=W(),[c,C]=p.useState(!1),[m,S]=p.useState(null),o=e.entity,l=e.entityName,g=e.filters||[],x=n||e.pageSize||20,v=i||e.queryPrefix||"",{activeView:h,createView:T,updateView:O,isViewConfigEnabled:w,visibleColumns:L,columnOrder:z,currentColumns:N,setColumnOrder:U,handleColumnVisibilityChange:_,currentConfiguration:y,hasConfigurationChanged:d,handleClearConfiguration:D,isLoadingColumns:j,apiColumns:E,requiredFields:k,queryParams:A}=Me({entity:o,queryPrefix:v,filters:g}),R={...A};g.forEach(I=>{const H=I.id;if(R[H]!==void 0)try{R[H]=JSON.parse(R[H])}catch{}});const q={...R,fields:k,limit:x,offset:R.offset?Number(R.offset):0},F=e.useData(k,q),B=e.columnAdapter||st(o),M=Qe(o,E||[],B),re=e.getColumns&&E?e.getColumns(E):M;if(F.isError)throw F.error;const ne=async()=>{try{h!=null&&h.is_system_default?await O.mutateAsync({name:h.name||null,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}}):await T.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},se=async()=>{if(h)try{await O.mutateAsync({name:h.name,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ie=()=>{C(!0),S(null)},ae=d?u.jsxs(u.Fragment,{children:[u.jsx(X,{variant:"secondary",size:"small",type:"button",onClick:D,children:f("actions.clear")}),u.jsx(Fe,{isDefaultView:(h==null?void 0:h.is_system_default)||!h,currentViewId:h==null?void 0:h.id,currentViewName:h==null?void 0:h.name,onSaveAsDefault:ne,onUpdateExisting:se,onSaveAsNew:ie})]}):null;return u.jsxs(ve,{className:"divide-y p-0",children:[u.jsx(ye,{data:F.data||[],columns:re,filters:g,getRowId:e.getRowId||(I=>I.id),rowCount:F.count,enablePagination:!0,enableSearch:!0,pageSize:x,isLoading:F.isLoading||j,layout:s,heading:t||l||(o?f(`${o}.domain`):""),subHeading:r,enableColumnVisibility:w,initialColumnVisibility:L,onColumnVisibilityChange:_,columnOrder:z,onColumnOrderChange:U,enableViewSelector:w,entity:o,currentColumns:N,filterBarContent:ae,rowHref:e.getRowHref,emptyState:e.emptyState||{empty:{heading:f(`${o}.list.noRecordsMessage`)}},prefix:v,actions:a,enableFilterMenu:!1}),c&&u.jsx(pe,{entity:o,currentColumns:N,currentConfiguration:y,editingView:m,onClose:()=>{C(!1),S(null)},onSaved:()=>{C(!1),S(null)}})]})}function ht(e){return{getRowId:t=>t.id,pageSize:20,queryPrefix:"",...e}}export{_t as C,ht as c,Ze as o,et as p};
