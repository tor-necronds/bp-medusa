import{u as ke}from"./chunk-C76H5USB-D2gMrc88.js";import{b as de,d as ue,b_ as ee,r as d,au as Oe,u as Ie,b$ as Le,j as e,c0 as y,H as fe,a5 as he,A as Ke,h as $e,ao as re,bz as b,aQ as Re,P as qe,T as ze,t as L,B as z,L as Be,c1 as Qe,c2 as Ue,c3 as Je,c4 as Xe,c5 as Ye,c6 as We,aD as Ce,bS as S,$ as Ge,K as Ze,c7 as He}from"./index-BcvhWi3G.js";var B=(s,a)=>{let t=a;t||(s instanceof He||s.message?t=s.message:t="An error occurred"),L.error(t)},xe=s=>{const a=ue("view_configurations"),t=Qe(s,{limit:100},{enabled:a&&!!s}),n=Ue(s,{enabled:a&&!!s}),c=Je(s,{onSuccess:()=>{L.success("View created")},onError:g=>{B(g,"Failed to create view")}}),h=Xe(s,{onSuccess:()=>{},onError:g=>{B(g,"Failed to update active view")}});return d.useMemo(()=>({isViewConfigEnabled:a,listViews:t,activeView:n,createView:c,setActiveView:h,isDefaultViewActive:(n==null?void 0:n.is_default_active)??!0}),[a,t,n,c,h])},me=(s,a)=>{const t=Ye(s,a,{onSuccess:()=>{L.success("View updated")},onError:c=>{B(c,"Failed to update view")}}),n=We(s,a,{onSuccess:()=>{L.success("View deleted successfully")},onError:c=>{B(c,"Failed to delete view")}});return{updateView:t,deleteView:n}},es=({entity:s,currentColumns:a,currentConfiguration:t,editingView:n,onClose:c,onSaved:h})=>{const{createView:g}=xe(s),{updateView:D}=me(s,(n==null?void 0:n.id)||""),[P,j]=d.useState(!1),{register:T,handleSubmit:A,formState:{errors:v}}=Ce({defaultValues:{name:(n==null?void 0:n.name)||""}}),u=async f=>{if(f.name.trim()){j(!0);try{if(n){const p=await D.mutateAsync({name:f.name.trim(),configuration:{visible_columns:(a==null?void 0:a.visible)||n.configuration.visible_columns,column_order:(a==null?void 0:a.order)||n.configuration.column_order,filters:(t==null?void 0:t.filters)||n.configuration.filters||{},sorting:(t==null?void 0:t.sorting)||n.configuration.sorting||null,search:(t==null?void 0:t.search)||n.configuration.search||""}});h(p.view_configuration)}else{const p=await g.mutateAsync({name:f.name.trim(),set_active:!0,configuration:{visible_columns:(a==null?void 0:a.visible)||[],column_order:(a==null?void 0:a.order)||[],filters:(t==null?void 0:t.filters)||{},sorting:(t==null?void 0:t.sorting)||null,search:(t==null?void 0:t.search)||""}});h(p.view_configuration)}}catch{}finally{j(!1)}}};return e.jsx(S,{open:!0,onOpenChange:c,children:e.jsxs(S.Content,{className:"flex flex-col",children:[e.jsxs(S.Header,{children:[e.jsx(S.Title,{asChild:!0,children:e.jsx(fe,{children:n?"Edit View Name":"Save as New View"})}),e.jsx(S.Description,{asChild:!0,children:e.jsx(he,{children:n?"Change the name of your saved view":"Save your current configuration as a new view"})})]}),e.jsxs("form",{onSubmit:A(u),className:"flex flex-1 flex-col",children:[e.jsx(S.Body,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(Ge,{htmlFor:"name",weight:"plus",children:"View Name"}),e.jsx(Ze,{...T("name",{required:"Name is required",validate:f=>f.trim().length>0||"Name cannot be empty"}),type:"text",placeholder:"Enter view name",autoFocus:!0}),v.name&&e.jsx("span",{className:"text-sm text-ui-fg-error",children:v.name.message})]})}),e.jsxs(S.Footer,{children:[e.jsx(S.Close,{asChild:!0,children:e.jsx(z,{variant:"secondary",size:"small",type:"button",children:"Cancel"})}),e.jsx(z,{variant:"primary",size:"small",type:"submit",isLoading:P,children:n?"Update":"Save"})]})]})]})})},ss=({entity:s,currentColumns:a,currentConfiguration:t})=>{const{listViews:n,activeView:c,setActiveView:h,isDefaultViewActive:g}=xe(s),D=(n==null?void 0:n.view_configurations)||[],[P,j]=d.useState(!1),[T,A]=d.useState(null),[v,u]=d.useState(null),[f,p]=d.useState({x:0,y:0}),[_,r]=d.useState(null),M=$e(),k=(c==null?void 0:c.view_configuration)||null,{deleteView:O}=me(s,_||""),K=async l=>{try{if(l===null){await h.mutateAsync(null);return}D.find(J=>J.id===l)&&await h.mutateAsync(l)}catch(m){console.error("Error in handleViewSelect:",m)}},Q=async l=>{await M({title:"Delete view",description:`Are you sure you want to delete "${l.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"})&&r(l.id)};d.useEffect(()=>{_&&O.mutateAsync&&O.mutateAsync().then(()=>{r(null)}).catch(()=>{r(null)})},[_,O.mutateAsync]);const U=l=>{A(l),j(!0)},E=async l=>{await M({title:"Reset system default",description:"This will delete the saved system default and revert to the original code-level defaults. All users will be affected. Are you sure?",confirmText:"Reset",cancelText:"Cancel"})&&r(l.id)},w=D.find(l=>l.is_system_default),I=D.filter(l=>!l.is_system_default),$=g;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:$?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>K(null),onContextMenu:l=>{l.preventDefault(),w&&(p({x:l.clientX,y:l.clientY}),u("default"))},children:"Default"}),w&&v==="default"&&e.jsxs(b,{open:!0,onOpenChange:l=>{l||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsx(b.Content,{align:"start",sideOffset:0,children:e.jsxs(b.Item,{onClick:()=>{E(w),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(Re,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Reset to code defaults"})]})})]})]}),I.length>0&&e.jsx("div",{className:"text-ui-fg-muted",children:"|"}),I.map(l=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx(re,{color:(k==null?void 0:k.id)===l.id?"blue":"grey",size:"xsmall",className:"cursor-pointer",onClick:()=>K(l.id),onContextMenu:m=>{m.preventDefault(),p({x:m.clientX,y:m.clientY}),u(l.id)},children:l.name}),v===l.id&&e.jsxs(b,{open:!0,onOpenChange:m=>{m||u(null)},children:[e.jsx(b.Trigger,{asChild:!0,children:e.jsx("div",{style:{position:"fixed",left:f.x,top:f.y,width:0,height:0}})}),e.jsxs(b.Content,{align:"start",sideOffset:0,children:[e.jsxs(b.Item,{onClick:()=>{U(l),u(null)},className:"flex items-center gap-x-2",children:[e.jsx(qe,{className:"text-ui-fg-subtle"}),e.jsx("span",{children:"Edit name"})]}),e.jsxs(b.Item,{onClick:()=>{Q(l),u(null)},className:"flex items-center gap-x-2 text-ui-fg-error",children:[e.jsx(ze,{}),e.jsx("span",{children:"Delete"})]})]})]})]},l.id))]}),P&&e.jsx(es,{entity:s,currentColumns:a,currentConfiguration:t,editingView:T,onClose:()=>{j(!1),A(null)},onSaved:async l=>{j(!1),A(null),L.success(`View "${l.name}" saved successfully`)}})]})},fs=({data:s=[],columns:a,filters:t,commands:n,action:c,actions:h,actionMenu:g,getRowId:D,rowCount:P=0,enablePagination:j=!0,enableSearch:T=!0,autoFocusSearch:A=!1,enableFilterMenu:v,rowHref:u,heading:f,headingLevel:p="h1",subHeading:_,prefix:r,pageSize:M=10,emptyState:k,rowSelection:O,isLoading:K=!1,layout:Q="auto",enableColumnVisibility:U=!1,initialColumnVisibility:E={},onColumnVisibilityChange:w,columnOrder:I,onColumnOrderChange:$,enableViewSelector:se=!1,entity:l,currentColumns:m,filterBarContent:J})=>{const{t:je}=de(),te=ue("view_configurations"),ae=te&&U,pe=te&&se,ne=t&&t.length>0,be=v!==void 0?v:ne,ve=n&&n.length>0,X=a.some(o=>o.enableSorting),[Y,le]=ee.useState(E);ee.useEffect(()=>{const o=Object.keys(Y).sort(),i=Object.keys(E).sort();(o.length!==i.length||o.some((F,V)=>F!==i[V])||Object.entries(E).some(([F,V])=>Y[F]!==V))&&le(E)},[E]);const we=ee.useCallback(o=>{le(o),w==null||w(o)},[w]),R=d.useMemo(()=>(t==null?void 0:t.map(o=>o.id))??[],[t]),ye=R.map(o=>N(o,r)),{offset:W,order:C,q:oe,...ie}=ke([...R,...X?["order"]:[],...T?["q"]:[],...j?["offset"]:[]],r),[rs,q]=Oe(),G=d.useMemo(()=>oe??"",[oe]),Se=o=>{q(i=>(o?i.set(N("q",r),o):i.delete(N("q",r)),i))},Ne=d.useMemo(()=>W?ls(W,M):{pageIndex:0,pageSize:M},[W,M]),De=o=>{q(i=>(o.pageIndex===0?i.delete(N("offset",r)):i.set(N("offset",r),ns(o).toString()),i))},Z=d.useMemo(()=>os(R,ie),[R,ie]),Te=o=>{q(i=>(Array.from(i.keys()).forEach(x=>{ye.includes(x)&&((r?x.replace(`${r}_`,""):x)in o||i.delete(x))}),Object.entries(o).forEach(([x,F])=>{const V=N(x,r);F!==void 0?i.set(V,JSON.stringify(F)):i.delete(V)}),i))},H=d.useMemo(()=>C?as(C):null,[C]),Ae=d.useMemo(()=>({filters:Z,sorting:H,search:G}),[Z,H,G]),_e=o=>{q(i=>{if(o){const x=ts(o);i.set(N("order",r),x)}else i.delete(N("order",r));return i})},{pagination:Ee,toolbar:Fe}=is(),ce=Ie(),Me=d.useCallback((o,i)=>{if(!u)return;const x=u(i);if(o.metaKey||o.ctrlKey||o.button===1){window.open(x,"_blank","noreferrer");return}if(o.shiftKey){window.open(x,void 0,"noreferrer");return}ce(x)},[ce,u]),Ve=Le({data:s,columns:a,filters:t,commands:n,rowCount:P,getRowId:D,onRowClick:u?Me:void 0,pagination:j?{state:Ne,onPaginationChange:De}:void 0,filtering:ne?{state:Z,onFilteringChange:Te}:void 0,sorting:X?{state:H,onSortingChange:_e}:void 0,search:T?{state:G,onSearchChange:Se}:void 0,rowSelection:O,isLoading:K,columnVisibility:ae?{state:Y,onColumnVisibilityChange:we}:void 0,columnOrder:ae&&I&&$?{state:I,onColumnOrderChange:$}:void 0}),Pe=f||_;return e.jsxs(y,{instance:Ve,className:Q==="fill"?"h-full [&_tr]:last-of-type:!border-b":void 0,children:[e.jsx(y.Toolbar,{className:"flex flex-col items-start justify-between gap-2 md:flex-row md:items-center",translations:Fe,filterBarContent:J,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-x-4",children:[Pe&&e.jsxs("div",{children:[f&&e.jsx(fe,{level:p,children:f}),_&&e.jsx(he,{size:"small",className:"text-ui-fg-subtle",children:_})]}),pe&&l&&e.jsx(ss,{entity:l,currentColumns:m,currentConfiguration:Ae})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[be&&e.jsx(y.FilterMenu,{}),X&&e.jsx(y.SortingMenu,{}),T&&e.jsx("div",{className:"w-full md:w-auto",children:e.jsx(y.Search,{placeholder:je("filters.searchLabel"),autoFocus:A})}),g&&e.jsx(Ke,{variant:"primary",...g}),h&&h.length>0&&e.jsx(cs,{actions:h}),!h&&c&&e.jsx(ge,{...c})]})]})}),e.jsx(y.Table,{emptyState:k}),j&&e.jsx(y.Pagination,{translations:Ee}),ve&&e.jsx(y.CommandBar,{selectedLabel:o=>`${o} selected`})]})};function ts(s){return s.desc?`-${s.id}`:s.id}function as(s){return s.startsWith("-")?{id:s.slice(1),desc:!0}:{id:s,desc:!1}}function ns(s){return s.pageIndex*s.pageSize}function ls(s,a){const t=parseInt(s);return{pageIndex:Math.floor(t/a),pageSize:a}}function os(s,a){if(!a)return{};const t={};for(const n of s){const c=a[n];c!==void 0&&(t[n]=JSON.parse(c))}return t}function N(s,a){return a?`${a}_${s}`:s}var is=()=>{const{t:s}=de(),a={of:s("general.of"),results:s("general.results"),pages:s("general.pages"),prev:s("general.prev"),next:s("general.next")},t={clearAll:s("actions.clearAll"),sort:s("filters.sortLabel"),columns:"Columns"};return{pagination:a,toolbar:t}},ge=({label:s,disabled:a,...t})=>{const n={size:"small",disabled:a??!1,type:"button",variant:"secondary"};return"to"in t?e.jsx(z,{...n,asChild:!0,children:e.jsx(Be,{to:t.to,children:s})}):e.jsx(z,{...n,onClick:t.onClick,children:s})},cs=({actions:s})=>e.jsx("div",{className:"flex items-center gap-x-2",children:s.map((a,t)=>e.jsx(ge,{...a},t))});export{fs as D,es as S,me as a,xe as u};
